server {
    listen   80; ## listen for ipv4; this line is default and implied
    server_name rss.{{ansible_fqdn}};

    include letsencrypt_params;

    location / {
        return 301 https://$server_name$request_uri;  # enforce https
    }

    access_log /var/log/nginx/rss-access_log;
    error_log  /var/log/nginx/rss-error_log;
    include drop.conf;
}

# HTTPS server
server {
  listen 127.0.0.1:443;
  server_name rss.{{ansible_fqdn}};

  root /opt/ttrss;
  index index.php;

  access_log /var/log/nginx/rss-tls-access_log;
  error_log  /var/log/nginx/rss-tls-error_log;

  location / {
    try_files $uri $uri/ =404;
    include php-cgi.conf;
  }

  #include tls.conf;
  include drop.conf;
}
